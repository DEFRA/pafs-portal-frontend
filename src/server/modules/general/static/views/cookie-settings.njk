{% extends 'layouts/page.njk' %}

{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}

{% block content %}
  {% if savedSuccessfully %}
    {{ govukNotificationBanner({
      text: t(localeNamespace ~ '.saved_message'),
      type: 'success',
      headingLevel: 2
    }) }}
  {% endif %}

  {{ appHeading({
    text: heading,
    widthClass: 'govuk-grid-column-full'
  }) }}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="govuk-body">
        <p class="govuk-body">
          {{t(localeNamespace ~ '.para1')}}
        </p>
        <p class="govuk-body">
          {{t(localeNamespace ~ '.para2')}}
        </p>
      <h2 class="govuk-heading-l">{{t(localeNamespace ~ '.intro_heading')}}</h2>

        <p class="govuk-body">
          {{t(localeNamespace ~ '.intro_text')}}
        </p>

        <h2 class="govuk-heading-m">{{t(localeNamespace ~ '.strictly_necessary_heading')}}</h2>

        <p class="govuk-body">
          {{t(localeNamespace ~ '.strictly_necessary_text')}}
        </p>

        <p class="govuk-body">
          {{t(localeNamespace ~ '.strictly_necessary_always_on')}}
        </p>
        <div class="app-cookie-panel">
        <p class="govuk-body"><strong>_pafs_session</strong> - {{t(localeNamespace ~ '.pafs_session_text')}}</p>
        <p class="govuk-body"><strong>cookies_preferences_set</strong> - {{t(localeNamespace ~ '.cookie_pref_text')}}</p>
        <p class="govuk-body"><strong>cookies_policy</strong> - {{t(localeNamespace ~ '.cookie_policy_text')}}</p>
      </div>
          <p class="govuk-body">
          <a href="https://www.gov.uk/help/cookie-details" class="govuk-link" target="_blank" rel="noopener">{{t(localeNamespace ~ '.gov_uk_help_link')}}</a>
        </p>

        <h2 class="govuk-heading-m">{{t(localeNamespace ~ '.analytics_heading')}}</h2>

        <p class="govuk-body">
          {{t(localeNamespace ~ '.analytics_text')}}
        </p>
        <p class="govuk-body">
          {{t(localeNamespace ~ '.analytics_sets_cookies_text')}}
        </p>

        <ul class="govuk-list govuk-list--bullet">
          <li>{{t(localeNamespace ~ '.analytics_bullet1')}}</li>
          <li>{{t(localeNamespace ~ '.analytics_bullet2')}}</li>
          <li>{{t(localeNamespace ~ '.analytics_bullet3')}}</li>
        </ul>

      
        <form method="post" class="cookie-settings-form">
          {{ govukRadios({
            idPrefix: "analyticsConsent",
            name: "analyticsConsent",
            fieldset: {
              legend: {
                text: t(localeNamespace ~ '.analytics_question'),
                isPageHeading: false,
                classes: "govuk-fieldset__legend--m"
              }
            },
            items: [
              {
                value: "yes",
                text: t(localeNamespace ~ '.option_yes'),
                checked: analyticsConsent === 'yes'
              },
              {
                value: "no",
                text: t(localeNamespace ~ '.option_no'),
                checked: analyticsConsent !== 'yes'
              }
            ]
          }) }}

          {{ govukButton({
            text: t(localeNamespace ~ '.save_button')
          }) }}
        </form>

      </div>
    </div>
  </div>

  <script type="module">
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.querySelector('.cookie-settings-form')
      if (form) {
        form.addEventListener('submit', function(event) {
          // Store preference in localStorage for immediate feedback
          const analyticsConsent = document.querySelector('input[name="analyticsConsent"]:checked').value
          localStorage.setItem('analytics_consent_preference', analyticsConsent)
        })
      }
    })
  </script>
{% endblock %}
