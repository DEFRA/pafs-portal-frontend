{% extends 'layouts/page.njk' %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block pageTitle %}{{ t('project-proposal.proposal_overview.title') }} | {{ serviceName }}
{% endblock %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% if errorSummary and(errorSummary | length) %}
        {% set errorList = [] %}
        {% for item in errorSummary %}
          {% set errorList = errorList.concat([
            {
              text: item.text,
              href: item.href
            }
          ]) %}
        {% endfor %}
        {{ govukErrorSummary({
          titleText: t('common.error_summary_title'),
          errorList: errorList
        }) }}
      {% endif %}

      <h1 class="govuk-heading-xl">{{ t('project-proposal.proposal_overview.heading') }}</h1>

      <dl class="govuk-summary-list govuk-summary-list--no-border govuk-!-margin-bottom-4">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-body-l">{{ t('project-proposal.proposal_overview.common.npn') }}</dt>
          <dd class="govuk-summary-list__value govuk-body-l">{{ values.referenceNumber or t('project-proposal.proposal_overview.common.not_submitted') }}</dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-body-l">{{ t('project-proposal.proposal_overview.common.last_updated') }}</dt>
          <dd class="govuk-summary-list__value govuk-body-l">
            {% if values.lastUpdated %}
              {{ values.lastUpdated | formatDate('d MMM yyyy') }}&nbsp;
              <span class="govuk-hint govuk-!-font-size-24">{{ values.lastUpdated | formatDate('HH:mm') }}</span>
            {% else %}
            {{ t('project-proposal.proposal_overview.common.not_submitted') }}
            {% endif %}
          </dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-body-l">{{ t('project-proposal.proposal_overview.common.status') }}</dt>
          <dd class="govuk-summary-list__value govuk-body-l">
            {{ t('project-proposal.proposal_overview.common.draft') }} &nbsp; | &nbsp;<a class="govuk-link" href="#">{{ t('project-proposal.proposal_overview.common.archive') }}</a> &nbsp; | &nbsp;<a class="govuk-link" href="#">{{ t('project-proposal.proposal_overview.common.delete') }}</a>
          </dd>
        </div>
      </dl>

      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">{{ t('project-proposal.proposal_overview.proposal_details_summary_card.title') }}</h2>
        </div>
        <div class="govuk-summary-card__content">
          <dl class="govuk-summary-list">
            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {{ t('project-proposal.proposal_overview.proposal_details_summary_card.project_name') }}
              </dt>
              <dd class="govuk-summary-list__value">
                {{ values.projectName or t('project-proposal.proposal_overview.common.not_provided') }}
              </dd>
              <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href="/proposal/create-proposal/title">
                  {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.project_name') }}</span>
                </a>
              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {{ t('project-proposal.proposal_overview.proposal_details_summary_card.rma') }}
              </dt>
              <dd class="govuk-summary-list__value">
                {{ values.rmaSelection or t('project-proposal.proposal_overview.common.not_provided') }}
              </dd>
              <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href="/proposal/create-proposal/rma-selection">
                  {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.rma') }}</span>
                </a>
              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {{ t('project-proposal.proposal_overview.proposal_details_summary_card.project_type') }}
              </dt>
              <dd class="govuk-summary-list__value">
                {% set projectTypeLabel = '' %}
                {% if values.projectType == 'DEF' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.def') %}
                {% elif values.projectType == 'REF' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.ref') %}
                {% elif values.projectType == 'REP' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.rep') %}
                {% elif values.projectType == 'ELO' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.elo') %}
                {% elif values.projectType == 'HCR' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.hcr') %}
                {% elif values.projectType == 'STR' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.str') %}
                {% elif values.projectType == 'STU' %}
                  {% set projectTypeLabel = t('project-proposal.project_type.options.stu') %}
                {% endif %}
                {{ projectTypeLabel or t('project-proposal.proposal_overview.common.not_provided') }}
              </dd>
              <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href="/proposal/create-proposal/project-type">
                  {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.project_type') }}</span>
                </a>
              </dd>
            </div>

            {% if values.interventionTypes %}
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  {{ t('project-proposal.proposal_overview.proposal_details_summary_card.intervention_types') }}
                </dt>
                <dd class="govuk-summary-list__value">
                  <ul class="govuk-list govuk-list--bullet">
                    {% for type in values.interventionTypes %}
                      <li>
                        {% if type == 'nfm' %}{{ t('project-proposal.intervention_type.options.nfm') }}
                        {% elif type == 'sds' %}{{ t('project-proposal.intervention_type.options.sds') }}
                        {% elif type == 'pfr' %}{{ t('project-proposal.intervention_type.options.pfr') }}
                        {% elif type == 'other' %}{{ t('project-proposal.intervention_type.options.other') }}
                        {% else %}{{ type }}
                        {% endif %}
                      </li>
                    {% endfor %}
                  </ul>
                </dd>
                <dd class="govuk-summary-list__actions">
                  <a class="govuk-link" href="/proposal/create-proposal/project-type-assets">
                    {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.intervention_types') }}</span>
                  </a>
                </dd>
              </div>

              {% set primaryInterventionType = values.primaryInterventionType %}
              {% if not primaryInterventionType and (values.primaryInterventionType | length) == 1 %}
                {% set primaryInterventionType = values.interventionTypes[0] %}
              {% endif %}

              {% if primaryInterventionType %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">
                    {{ t('project-proposal.proposal_overview.proposal_details_summary_card.primary_benefit_intervention') }}
                  </dt>
                  <dd class="govuk-summary-list__value">
                    {% if primaryInterventionType == 'nfm' %}{{ t('project-proposal.intervention_type.options.nfm') }}
                    {% elif primaryInterventionType == 'sds' %}{{ t('project-proposal.intervention_type.options.sds') }}
                    {% elif primaryInterventionType == 'pfr' %}{{ t('project-proposal.intervention_type.options.pfr') }}
                    {% elif primaryInterventionType == 'other' %}{{ t('project-proposal.intervention_type.options.other') }}
                    {% else %}{{ primaryInterventionType }}
                    {% endif %}
                  </dd>
                  <dd class="govuk-summary-list__actions">
                    <a class="govuk-link" href="/proposal/create-proposal/project-type-primary-benefit">
                      {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.primary_benefit_intervention') }}</span>
                    </a>
                  </dd>
                </div>
              {% endif %}
            {% endif %}

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {{ t('project-proposal.proposal_overview.proposal_details_summary_card.financial_year_start') }}
              </dt>
              <dd class="govuk-summary-list__value">
                {{ values.financialStartYearLabel or t('project-proposal.proposal_overview.common.not_provided') }}
              </dd>
              <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href="/proposal/create-proposal/financial-year">
                  {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.financial_year_start') }}</span>
                </a>
              </dd>
            </div>

            <div class="govuk-summary-list__row">
              <dt class="govuk-summary-list__key">
                {{ t('project-proposal.proposal_overview.proposal_details_summary_card.financial_year_end') }}
              </dt>
              <dd class="govuk-summary-list__value">
                {{ values.financialEndYearLabel or t('project-proposal.proposal_overview.common.not_provided') }}
              </dd>
              <dd class="govuk-summary-list__actions">
                <a class="govuk-link" href="/proposal/create-proposal/financial-year-spending?from=overview">
                  {{ t('common.change') }}<span class="govuk-visually-hidden"> {{ t('project-proposal.proposal_overview.proposal_details_summary_card.financial_year_end') }}</span>
                </a>
              </dd>
            </div>
          </dl>
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Location</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/location">
                {% if data['grid-reference'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> location</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['grid-reference'] or data['benefit-area-file-uploaded'] %}
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-half">
                <h3 class="govuk-heading-s govuk-!-margin-bottom-2">National Grid Reference</h3>
                <p class="govuk-body govuk-!-margin-bottom-1">{{ data['grid-reference'] }}</p>
                {% if locationMapUrl %}
                  <p class="govuk-body govuk-!-margin-bottom-4">
                    <a class="govuk-link" href="{{ locationMapUrl }}" target="_blank" rel="noopener noreferrer">See this location on a map (opens in new tab)</a>
                  </p>
                {% endif %}

                <p class="govuk-body govuk-!-margin-bottom-1"><strong>Region:</strong> South West</p>
                <p class="govuk-body govuk-!-margin-bottom-1"><strong>County:</strong></p>
                <p class="govuk-body"><strong>Constituency:</strong> Bristol North West</p>
              </div>

              <div class="govuk-grid-column-one-half">
                <h3 class="govuk-heading-s govuk-!-margin-bottom-2">Project benefit area</h3>
                {% if data['benefit-area-file-uploaded'] %}
                  <div style="display: flex; align-items: flex-start; gap: 15px;">
                    <div style="flex-shrink: 0;">
                      <svg width="60" height="80" viewBox="0 0 60 80" style="border: 2px solid #b1b4b6;">
                        <rect width="60" height="80" fill="#f3f2f1"/>
                        <rect x="5" y="5" width="50" height="10" fill="#d4d4d4"/>
                        <rect x="5" y="20" width="35" height="6" fill="#d4d4d4"/>
                        <rect x="5" y="30" width="40" height="6" fill="#d4d4d4"/>
                        <rect x="5" y="40" width="30" height="6" fill="#d4d4d4"/>
                        <text x="30" y="65" text-anchor="middle" font-size="12" fill="#505a5f" font-family="Arial">ZIP</text>
                      </svg>
                    </div>
                    <div style="flex-grow: 1;">
                      <p class="govuk-body govuk-!-margin-bottom-1">
                        <a class="govuk-link" href="#">{{ data['benefit-area-file'] or 'magic_graphics1.zip' }}</a>
                      </p>
                      <p class="govuk-body govuk-body-s govuk-!-margin-bottom-1">Size 3.38 KB</p>
                      <p class="govuk-body govuk-body-s">Uploaded {{ data['benefit-area-uploaded-date'] or '11 December 2025' }}</p>
                    </div>
                  </div>
                {% else %}
                  <p class="govuk-body">No benefit area file uploaded yet</p>
                {% endif %}
              </div>
            </div>
          {% else %}
            <p class="govuk-body">No location added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Important dates</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/important-dates/obc-start?from=overview">
                {% if data['important-dates-added'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> important dates</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['important-dates-added'] %}
            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Outline business case start date</dt>
                <dd class="govuk-summary-list__value">
                  {{ importantDates.obcStart or 'Not Provided' }}
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Outline business case completion date</dt>
                <dd class="govuk-summary-list__value">
                  {{ importantDates.obcCompletion or 'Not Provided' }}
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Contract awarded</dt>
                <dd class="govuk-summary-list__value">
                  {{ importantDates.contractAwarded or 'Not Provided' }}
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Start construction</dt>
                <dd class="govuk-summary-list__value">
                  {{ importantDates.startConstruction or 'Not Provided' }}
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Ready for service</dt>
                <dd class="govuk-summary-list__value">
                  {{ importantDates.readyForService or 'Not Provided' }}
                </dd>
              </div>
              {% if data['could-start-earlier'] %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">Could start earlier with Grant in Aid</dt>
                  <dd class="govuk-summary-list__value">
                    {% if data['could-start-earlier'] == 'yes' %}Yes{% else %}No{% endif %}
                  </dd>
                </div>
                {% if data['could-start-earlier'] == 'yes' and importantDates.earliestWithGia %}
                  <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Earliest start date with Grant in Aid</dt>
                    <dd class="govuk-summary-list__value">
                      {{ importantDates.earliestWithGia }}
                    </dd>
                  </div>
                {% endif %}
              {% endif %}
            </dl>
          {% else %}
            <p class="govuk-body">No important dates added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Funding sources and spending</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/funding-sources">
                {% if fundingSectionStarted %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> the funding sources and spending details</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if fundingSectionStarted %}
            {% if fundingSummary.selectedSources and (fundingSummary.selectedSources | length) > 0 %}
              <table class="govuk-table full-table">
                <thead class="govuk-table__head">
                  <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header">Funding Source</th>
                    <th scope="col" class="govuk-table__header align-right">Total Estimated Spend</th>
                  </tr>
                </thead>
                <tbody class="govuk-table__body">
                  {% for source in fundingSummary.selectedSources %}
                    {% set sourceTotal = 0 %}
                    {% for year in fundingYears %}
                      {% set value = (data['funding-values'] and data['funding-values'][year] and data['funding-values'][year][source.key]) or 0 %}
                      {% set sourceTotal = sourceTotal + (value | int) %}
                    {% endfor %}
                    <tr class="govuk-table__row">
                      <td class="govuk-table__cell">{{ source.label }}</td>
                      <td class="govuk-table__cell align-right">£{{ sourceTotal }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>

              <details class="govuk-details govuk-!-margin-top-4" data-module="govuk-details">
                <summary class="govuk-details__summary">
                  <span class="govuk-details__summary-text">View funding sources and spending detail</span>
                </summary>
                <div class="govuk-details__text">
                  <div class="scroll-horz">
                    <table class="govuk-table funding_sources_and_spending_detail_table">
                      <thead class="govuk-table__head">
                        <tr class="govuk-table__row">
                          <th scope="col" class="govuk-table__header financial-year-column">Financial year</th>
                          {% for source in fundingSummary.selectedSources %}
                            <th scope="col" class="govuk-table__header align-right data-column">{{ source.label }}</th>
                          {% endfor %}
                          <th scope="col" class="govuk-table__header align-right data-total">Total (£)</th>
                        </tr>
                      </thead>
                      <tbody class="govuk-table__body">
                        {% for year in fundingYears %}
                          <tr class="govuk-table__row">
                            <td class="govuk-table__cell financial_year">April {{ year }} to March {{ year + 1 }}</td>
                            {% set rowTotal = 0 %}
                            {% for source in fundingSummary.selectedSources %}
                              {% set value = (data['funding-values'] and data['funding-values'][year] and data['funding-values'][year][source.key]) or 0 %}
                              {% set numValue = value | int %}
                              {% set rowTotal = rowTotal + numValue %}
                              <td class="govuk-table__cell numeric">{{ numValue }}</td>
                            {% endfor %}
                            <td class="govuk-table__cell row-total numeric">{{ rowTotal }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                      <tfoot class="govuk-table__foot">
                        <tr class="govuk-table__row">
                          <td class="govuk-table__cell">Total (£)</td>
                          {% set footerGrandTotal = 0 %}
                          {% for source in fundingSummary.selectedSources %}
                            {% set columnTotal = 0 %}
                            {% for year in fundingYears %}
                              {% set value = (data['funding-values'] and data['funding-values'][year] and data['funding-values'][year][source.key]) or 0 %}
                              {% set columnTotal = columnTotal + (value | int) %}
                            {% endfor %}
                            {% set footerGrandTotal = footerGrandTotal + columnTotal %}
                            <td class="govuk-table__cell numeric">{{ columnTotal }}</td>
                          {% endfor %}
                          <td class="govuk-table__cell numeric grand-total">{{ footerGrandTotal }}</td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>

                  {% set hasContributors = false %}
                  {% if data['public-contributors'] and (data['public-contributors'] | length) > 0 %}
                    {% set hasContributors = true %}
                  {% endif %}
                  {% if data['private-contributors'] and (data['private-contributors'] | length) > 0 %}
                    {% set hasContributors = true %}
                  {% endif %}
                  {% if data['other-ea-contributors'] and (data['other-ea-contributors'] | length) > 0 %}
                    {% set hasContributors = true %}
                  {% endif %}

                  {% if hasContributors %}
                    <div id="contributor_detail">
                      <br>
                      {% if data['public-contributors'] and (data['public-contributors'] | length) > 0 %}
                        <div>
                          <h3 class="govuk-heading-s">Public sector contributors:</h3>
                          {% for contributor in data['public-contributors'] %}
                            <p class="govuk-body">{{ contributor.name }}</p>
                          {% endfor %}
                        </div>
                      {% endif %}

                      {% if data['private-contributors'] and (data['private-contributors'] | length) > 0 %}
                        <div>
                          <h3 class="govuk-heading-s">Private sector contributors:</h3>
                          {% for contributor in data['private-contributors'] %}
                            <p class="govuk-body">{{ contributor.name }}</p>
                          {% endfor %}
                        </div>
                      {% endif %}

                      {% if data['other-ea-contributors'] and (data['other-ea-contributors'] | length) > 0 %}
                        <div>
                          <h3 class="govuk-heading-s">Other Environment Agency contributors:</h3>
                          {% for contributor in data['other-ea-contributors'] %}
                            <p class="govuk-body">{{ contributor.name }}</p>
                          {% endfor %}
                        </div>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
              </details>
            {% else %}
              <p class="govuk-body">No funding sources selected yet</p>
            {% endif %}
          {% else %}
            <p class="govuk-body">No funding sources and spending details added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Risks and properties benefitting</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/risks">
                {% if data['risks-selected'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> risks and properties benefitting</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['risks-selected'] %}
            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  Selected risks
                </dt>
                <dd class="govuk-summary-list__value">
                  <ul class="govuk-list govuk-list--bullet">
                    {% if data['fluvial-flooding'] %}<li>Fluvial flooding (river flooding)</li>{% endif %}
                    {% if data['tidal-flooding'] %}<li>Tidal flooding</li>{% endif %}
                    {% if data['groundwater-flooding'] %}<li>Groundwater flooding</li>{% endif %}
                    {% if data['surface-water-flooding'] %}<li>Surface water flooding</li>{% endif %}
                    {% if data['sea-flooding'] %}<li>Sea flooding</li>{% endif %}
                    {% if data['reservoir-flooding'] %}<li>Reservoir flooding</li>{% endif %}
                    {% if data['coastal-erosion'] %}<li>Coastal erosion</li>{% endif %}
                  </ul>
                </dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  Main risk
                </dt>
                <dd class="govuk-summary-list__value">
                  {% if data['main-risk'] == 'fluvial-flooding' %}Fluvial flooding (river flooding)
                  {% elif data['main-risk'] == 'tidal-flooding' %}Tidal flooding
                  {% elif data['main-risk'] == 'groundwater-flooding' %}Groundwater flooding
                  {% elif data['main-risk'] == 'surface-water-flooding' %}Surface water flooding
                  {% elif data['main-risk'] == 'sea-flooding' %}Sea flooding
                  {% elif data['main-risk'] == 'reservoir-flooding' %}Reservoir flooding
                  {% elif data['main-risk'] == 'coastal-erosion' %}Coastal erosion
                  {% endif %}
                </dd>
              </div>

              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  Properties affected by flooding
                </dt>
                <dd class="govuk-summary-list__value">
                  {% if data['no-properties-affected-flooding'] == 'true' %}
                    No properties affected by flooding
                  {% else %}
                    <ul class="govuk-list">
                      {% if data['properties-maintaining-protection'] %}<li>Maintaining flood protection: {{ data['properties-maintaining-protection'] }}</li>{% endif %}
                      {% if data['properties-reducing-risk-50-plus'] %}<li>Reducing flood risk (50% or more): {{ data['properties-reducing-risk-50-plus'] }}</li>{% endif %}
                      {% if data['properties-reducing-risk-less-50'] %}<li>Reducing flood risk (less than 50%): {{ data['properties-reducing-risk-less-50'] }}</li>{% endif %}
                      {% if data['properties-increasing-resilience'] %}<li>Increasing flood resilience: {{ data['properties-increasing-resilience'] }}</li>{% endif %}
                    </ul>
                  {% endif %}
                </dd>
              </div>

              {% if data['coastal-erosion'] %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">
                    Properties affected by coastal erosion
                  </dt>
                  <dd class="govuk-summary-list__value">
                    {% if data['no-properties-affected-coastal'] == 'true' %}
                      No properties affected by coastal erosion
                    {% else %}
                      <ul class="govuk-list">
                        {% if data['properties-maintaining-coastal-protection'] %}<li>Maintaining coastal erosion protection: {{ data['properties-maintaining-coastal-protection'] }}</li>{% endif %}
                        {% if data['properties-reducing-coastal-risk'] %}<li>Reducing coastal erosion risk: {{ data['properties-reducing-coastal-risk'] }}</li>{% endif %}
                      </ul>
                    {% endif %}
                  </dd>
                </div>
              {% endif %}

              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                  Current flood risk
                </dt>
                <dd class="govuk-summary-list__value">
                  {% if data['current-flood-risk'] == 'high' %}High risk (greater than 3.3%)
                  {% elif data['current-flood-risk'] == 'medium' %}Medium risk (between 1% and 3.3%)
                  {% elif data['current-flood-risk'] == 'low' %}Low risk (between 0.1% and 1%)
                  {% elif data['current-flood-risk'] == 'very-low' %}Very low risk (less than 0.1%)
                  {% else %}Not provided{% endif %}
                </dd>
              </div>

              {% if data['coastal-erosion'] %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">
                    Current coastal erosion risk
                  </dt>
                  <dd class="govuk-summary-list__value">
                    {% if data['current-coastal-risk'] == 'medium-term' %}Medium term loss (≤ 30 years)
                    {% elif data['current-coastal-risk'] == 'longer-term' %}Longer term loss (> 30 years)
                    {% else %}Not provided{% endif %}
                  </dd>
                </div>
              {% endif %}
            </dl>
          {% else %}
            <p class="govuk-body">No risks and properties benefitting data added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Approach</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/approach">
                {% if data['approach'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> approach</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['approach'] %}
            <p class="govuk-body">{{ data['approach'] }}</p>
          {% else %}
            <p class="govuk-body">No approach added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Environmental benefits</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/any-environmental-benefits">
                {% if data['any-environmental-benefits'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> environmental benefits</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['any-environmental-benefits'] == 'yes' %}
            <dl class="govuk-summary-list">
              {% for benefit in environmentalBenefits %}
                {% if data[benefit.id] == 'yes' %}
                  <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                      {% if benefit.id == 'intertidal-habitat' %}Intertidal wetland habitat
                      {% elif benefit.id == 'woodland-habitat' %}Woodland habitat
                      {% elif benefit.id == 'wet-woodland-habitat' %}Wet woodland habitat
                      {% elif benefit.id == 'wetland-or-wet-grassland-habitat' %}Wetland or wet grassland habitat
                      {% elif benefit.id == 'grassland-habitat' %}Grassland habitat
                      {% elif benefit.id == 'heathland-habitat' %}Heathland habitat
                      {% elif benefit.id == 'ponds-lakes-habitat' %}Pond and/or lake habitat
                      {% elif benefit.id == 'arable-land-habitat' %}Arable land habitat
                      {% elif benefit.id == 'comprehensive-restoration' %}Comprehensive restoration
                      {% elif benefit.id == 'partial-restoration' %}Partial restoration
                      {% elif benefit.id == 'create-habitat-watercourse' %}Single major physical or habitat of watercourse
                      {% endif %}
                    </dt>
                    <dd class="govuk-summary-list__value">{{ data[benefit.id + '-amount'] }} {{ benefit.unit }}</dd>
                  </div>
                {% endif %}
              {% endfor %}
            </dl>
          {% elif data['any-environmental-benefits'] == 'no' %}
            <p class="govuk-body">No environmental benefits</p>
          {% else %}
            <p class="govuk-body">No environmental benefits data added yet</p>
          {% endif %}
        </div>
      </div>

      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title">Urgency</h2>
          <ul class="govuk-summary-card__actions">
            <li class="govuk-summary-card__action">
              <a class="govuk-link" href="/proposal/create-proposal/urgency">
                {% if data['urgency'] %}Change{% else %}Add{% endif %}<span class="govuk-visually-hidden"> urgency</span>
              </a>
            </li>
          </ul>
        </div>
        <div class="govuk-summary-card__content">
          {% if data['urgency'] %}
            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Reason</dt>
                <dd class="govuk-summary-list__value">
                  {% if data['urgency'] == 'not_urgent' %}The project is not urgent
                  {% elif data['urgency'] == 'statutory_need' %}There is a business critical statutory need
                  {% elif data['urgency'] == 'legal_need' %}There is a business critical legal need
                  {% elif data['urgency'] == 'health_and_safety' %}There is a health and safety issue
                  {% elif data['urgency'] == 'emergency_works' %}There is an emergency
                  {% elif data['urgency'] == 'time_limited' %}There is a specific aspect of the project that has a time limit
                  {% endif %}
                </dd>
              </div>
              {% if data['urgency'] != 'not_urgent' %}
                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">Details</dt>
                  <dd class="govuk-summary-list__value">{{ data['urgency-details'] }}</dd>
                </div>
              {% endif %}
            </dl>
          {% else %}
            <p class="govuk-body">No urgency data added yet</p>
          {% endif %}
        </div>
      </div>

      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible govuk-!-margin-bottom-6">

      <p class="govuk-body">By submitting this proposal you confirm that all information is accurate and complete.</p>

      <form method="post" novalidate>
        {{ govukButton({
          text: t('common.buttons.submit_proposal')
        }) }}
      </form>
    </div>
  </div>

{% endblock %}
